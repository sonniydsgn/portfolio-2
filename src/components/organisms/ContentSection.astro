---
import { slugify, transliterate } from 'transliteration'

interface Props {
	title: string
	icon?: string
	size?: 'null' | 'sm' | 'md'
	type?: 'section' | 'accordion'
	class?: string
}

const { title, icon = '◌', size = 'md', type = 'section', class: className, ...props } = Astro.props

const slug = title && slugify(transliterate(title))
---

<section
	data-toc-section={type === 'section' ? '' : null}
	class:list={[
		'content-section',
		{ 'content-section--sm': size === 'sm' },
		{ 'content-section--null': size === 'null' },
		className,
	]}
	id={slug}
	{...props}
>
	<header class="content-section__header">
		<span class="text-h2 content-section__icon">{icon}</span>
		<h2 class="text-h2 content-section__title">{title}</h2>
		<slot name="header" />
	</header>
	<div class="content-section__body">
		<slot />
	</div>
</section>

<style>
	.content-section {
		--section-padding: 48px;
		--inline-padding: 24px;

		display: flex;
		flex-direction: column;
		border: 1px solid var(--border-secondary);
		border-radius: var(--br-lg);
		background-color: var(--bg-primary);

		@media (width <= 880) {
			--inline-padding: 16px;
			--section-padding: 32px;
		}
	}

	.content-section--sm {
		--section-padding: 24px;

		@media (width <= 880) {
			--section-padding: 12px;
		}
	}

	.content-section--null {
		--section-padding: 0px;

		@media (width <= 880) {
			--section-padding: 0px;
		}
	}

	.content-section__header {
		display: flex;
		border-bottom: 1px solid var(--border-secondary);
		padding-inline: var(--inline-padding);
		padding-block-start: 16px;
		padding-block-end: 12px;

		@media (width <= 880) {
			padding-block-start: 12px;
			padding-block-end: 10px;
		}
	}

	.content-section__icon {
		margin-inline-end: 8px;
	}

	.content-section__title {
		margin-inline-end: auto;
	}

	.content-section__body {
		display: flex;
		flex-direction: column;
		padding-inline: var(--inline-padding);
		padding-block-start: var(--section-padding);
		padding-block-end: 48px;

		@media (width <= 880) {
			padding-block-end: 32px;
		}
	}
</style>

<style is:global>
	.content-section__body {
		/* заголовки */
		h3 + * {
			margin-block-start: 16px;

			@media (width <= 880) {
				margin-block-start: 12px;
			}
		}

		h3 + .info-list,
		h3 + .info-card {
			margin-block-start: 12px;

			@media (width <= 880) {
				margin-block-start: 8px;
			}
		}

		* + h3 {
			margin-block-start: 32px;

			@media (width <= 880) {
				margin-block-start: 24px;
			}
		}

		picture + h3,
		figure + h3,
		.video-container + h3 {
			margin-block-start: 40px;

			@media (width <= 880) {
				margin-block-start: 32px;
			}
		}

		/* ссылки */
		a.link {
			opacity: 0.8;

			@media (hover) {
				&:hover {
					opacity: 1;
				}
			}
		}

		/* параграфы */
		p,
		figcaption {
			/* hack for temporary disabling chrome font boosting */
			max-height: 999999px;
		}

		p {
			max-width: 95%;

			@media (width <= 880) {
				max-width: 100%;
			}
		}

		& > p + p {
			margin-block-start: 12px;

			@media (width <= 880) {
				margin-block-start: 8px;
			}
		}

		& > ul:not(.list-reset) + p,
		& > ol:not(.list-reset) + p {
			margin-block-start: 16px;

			@media (width <= 880) {
				margin-block-start: 12px;
			}
		}

		& > picture + *,
		& > .video-container + *,
		& > figure + *,
		& > * + figure,
		& > * + picture,
		& > * + .video-container {
			margin-block-start: 20px;

			@media (width <= 880) {
				margin-block-start: 16px;
			}
		}

		/* медиа-материалы */
		& > picture + picture,
		& > picture + .video-container,
		& > picture + figure,
		& > .video-container + .video-container,
		& > .video-container + figure,
		& > .video-container + picture,
		& > figure + figure,
		& > figure + picture,
		& > figure + .video-container {
			margin-block-start: 32px;

			@media (width <= 880) {
				margin-block-start: 24px;
			}
		}

		figcaption {
			--padding: 8px;

			margin-block-start: 12px;
			padding-inline: var(--padding);
			max-width: calc(714px + 2 * var(--padding));
			color: var(--text-secondary-0);
			font-style: normal;
			font-weight: 300;
			font-size: var(--font-sm);
			line-height: var(--lh-sm);

			@media (width <= 880) {
				--padding: 4px;
			}
		}

		/* списки */
		ul:not(.list-reset),
		ol:not(.list-reset) {
			display: flex;
			flex-direction: column;
			gap: 12px;
			padding-inline-start: 32px;

			@media (width <= 880) {
				gap: 8px;
			}
		}

		p + ul:not(.list-reset),
		p + ol:not(.list-reset) {
			margin-block-start: 8px;

			@media (width <= 880) {
				margin-block-start: 4px;
			}
		}

		/* заметки */
		* + .note,
		.note + * {
			margin-block-start: 20px;

			@media (width <= 880) {
				margin-block-start: 16px;
			}
		}

		/* остальное */
		hr {
			margin: 0;
			border: 1px solid var(--border-secondary);
		}

		code {
			border-radius: var(--br-sm);
			background-color: var(--bg-tertiary);
			padding-inline: 6px;
			font-size: var(--font-sm);
			font-family: var(--ff-secondary);
		}

		strong {
			font-weight: 600;
		}
	}
</style>
